<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TOTOBAR</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#050505">

<style>
body{
  margin:0;
  background: radial-gradient(circle at top, #111, #050505);
  color:#f5d28a;
  font-family:Arial, sans-serif;
  max-width:900px;
  margin:0 auto;
  padding:14px;
}

/* HEADER */
header{
  text-align:center;
  margin-bottom:20px;
}

.logo{
  width:280px;
  animation: pop 0.6s ease;
}

@keyframes pop{
  0%{transform:scale(0.8); opacity:0;}
  100%{transform:scale(1); opacity:1;}
}

h2{
  margin-top:10px;
}

/* SECCIONES */
.section{
  display:none;
  margin-bottom:32px;
  animation: fadeIn 0.35s ease;
}

@keyframes fadeIn{
  from{opacity:0; transform:translateY(8px);}
  to{opacity:1; transform:translateY(0);}
}

/* BOTONES COLOR ORO WAITer */
button{
  padding:14px 18px;
  font-size:18px;
  border:none;
  border-radius:12px;
  background:linear-gradient(145deg, #8a6a2f, #5f4a1a);
  color:white;
  font-weight:bold;
  box-shadow:0 4px 12px rgba(138,106,47,0.6);
  margin-top:10px;
  width:100%;
  transition:transform 0.15s ease, box-shadow 0.15s ease;
}

button:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 22px rgba(138,106,47,0.7);
}

button:active{
  transform:scale(0.97);
}

/* GRILLA 3 EN 3 */
.tabs{
  display:grid;
  grid-template-columns:repeat(3, 1fr);
  gap:10px;
  justify-items:center;
  margin-bottom:20px;
}

.tabs button{
  width:100%;
  text-align:center;
}

/* TARJETAS */
.card{
  background:#101010;
  padding:18px;
  border-radius:16px;
  margin-bottom:20px;
  border:1px solid rgba(138,106,47,0.35);
  box-shadow:0 4px 14px rgba(0,0,0,0.8);
  font-size:18px;
}
</style>
</head>
<body>

<header>
  <img src="logo.png" class="logo">
  <h2>TOTOBAR</h2>
</header>

<!-- SELECTOR -->
<div id="selector" class="section" style="display:block;">
  <h2>Seleccionar modo</h2>
  <div class="tabs">
    <button onclick="login('cliente')">Cliente</button>
    <button onclick="login('mozo')">Mozo</button>
    <button onclick="login('cocina')">Cocina</button>
    <button onclick="login('admin')">Admin</button>
    <button onclick="login('dueno')">Dueño</button>
  </div>
</div>

<!-- CLIENTE -->
<div id="cliente" class="section">
  <button onclick="mostrar('selector')">⬅ Volver</button>
  <h2>Menú</h2>
  <div class="tabs" id="tabsCategorias"></div>
  <div id="productos"></div>
</div>

<audio id="clickSound" src="click.mp3"></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey:"TU_API_KEY",
  authDomain:"menu-pro-app.firebaseapp.com",
  projectId:"menu-pro-app",
  storageBucket:"menu-pro-app.firebasestorage.app",
  messagingSenderId:"42917274964",
  appId:"1:42917274964:web:3be3c9c124b9c69b8994c1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let categorias = [];
let productos = [];

/* PWA */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(() => console.log('SW registrado'))
      .catch(err => console.log('SW error', err));
  });
}

/* CARGAR CATEGORIAS */
function cargarCategorias(){
  onSnapshot(collection(db,"categorias"), snap=>{
    categorias=[];
    snap.forEach(d=>categorias.push(d.data().nombre));
    renderTabs();
  });
}

/* CARGAR PRODUCTOS */
function cargarProductos(){
  onSnapshot(collection(db,"productos"), snap=>{
    productos=[];
    snap.forEach(d=>productos.push(d.data()));
  });
}

/* TABS */
function renderTabs(){
  const tabs=document.getElementById("tabsCategorias");
  tabs.innerHTML="";
  categorias.forEach(cat=>{
    tabs.innerHTML+=`<button onclick="mostrarCat('${cat}')">${cat}</button>`;
  });
}

/* MOSTRAR PRODUCTOS */
window.mostrarCat=(cat)=>{
  const prodDiv=document.getElementById("productos");
  prodDiv.innerHTML="";

  productos.forEach(p=>{
    if(p.categoria===cat){
      prodDiv.innerHTML+=`
        <div class="card">
          <h3>${p.nombre}</h3>
          <p>$${p.precio}</p>
        </div>
      `;
    }
  });

  reproducirSonido();
};

/* SONIDO */
function reproducirSonido(){
  const audio=document.getElementById("clickSound");
  audio.currentTime = 0;
  audio.play();
}

/* LOGIN */
window.login=(rol)=>{
  if(rol==="cliente"){
    mostrar("cliente");
    return;
  }

  const pass=prompt("Contraseña:");
  if(!pass) return;

  if(rol==="mozo" && pass==="mozo2026") window.location.href="waiter.html";
  else if(rol==="cocina" && pass==="cocina2026") window.location.href="kitchen.html";
  else if(rol==="admin" && pass==="toto321") window.location.href="admin.html";
  else if(rol==="dueno" && pass==="toto321") window.location.href="dueño.html";
  else alert("Contraseña incorrecta");
};

/* MOSTRAR SECCION */
window.mostrar=(id)=>{
  document.querySelectorAll(".section").forEach(s=>s.style.display="none");
  document.getElementById(id).style.display="block";
};

cargarCategorias();
cargarProductos();
</script>

</body>
</html>