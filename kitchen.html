<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cocina</title>

<style>
body{
  background:#000;
  color:#d4af37;
  font-family:Arial;
  padding:12px;
}

.card{
  background:#0b0b0b;
  border:1px solid rgba(212,175,55,0.4);
  padding:14px;
  border-radius:14px;
  margin-bottom:14px;
}

button{
  padding:12px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  margin-top:6px;
  cursor:pointer;
}

.preparando{
  background:#b58c2f;
  color:black;
}

.listo{
  background:#0f8f0f;
  color:white;
}

.eliminar{
  background:red;
  color:white;
}
</style>
</head>
<body>

<h1>Panel Cocina</h1>
<audio id="alerta" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>
<audio id="click" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<div id="pedidos"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE",
  messagingSenderId: "TU_SENDER",
  appId: "TU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const contenedor = document.getElementById("pedidos");
const sonido = document.getElementById("alerta");
const click = document.getElementById("click");

/* SONIDO GLOBAL */
document.addEventListener("click", (e)=>{
  if(e.target.tagName === "BUTTON"){
    click.play();
  }
});

/* PEDIDOS EN TIEMPO REAL */
onSnapshot(collection(db,"pedidos"), snap=>{
  contenedor.innerHTML = "";

  snap.forEach(d=>{
    const data = d.data();

    if(data.estado !== "entregado"){
      if(data.estado === "pendiente") sonido.play();

      contenedor.innerHTML += `
      <div class="card">
        <h3>Mesa ${data.mesa}</h3>
        <p><strong>Items:</strong><br>
          ${(data.items||[]).map(i=>`${i.prod} - $${i.precio}`).join("<br>")}
        </p>
        <p><strong>Nota:</strong> ${data.nota || "sin nota"}</p>
        <p><strong>Estado:</strong> ${data.estado}</p>

        <button class="preparando" onclick="preparando('${d.id}')">
          Preparando
        </button>
        <button class="listo" onclick="listo('${d.id}')">
          Listo
        </button>
        <button class="eliminar" onclick="borrar('${d.id}')">
          Eliminar
        </button>
      </div>`;
    }
  });
});

/* PREPARANDO */
window.preparando = async (id) => {
  await updateDoc(doc(db,"pedidos",id),{estado:"preparando"});
};

/* LISTO */
window.listo = async (id) => {
  await updateDoc(doc(db,"pedidos",id),{estado:"listo"});

  document.body.style.background = "#0f8f0f";

  // verde mÃ¡s tiempo
  setTimeout(()=> {
    document.body.style.background = "#000";
  }, 3000);

  alert("Pedido listo");
};

/* ELIMINAR */
window.borrar = async (id) => {
  if(!confirm("Eliminar?")) return;
  await deleteDoc(doc(db,"pedidos",id));
};
</script>

</body>
</html>