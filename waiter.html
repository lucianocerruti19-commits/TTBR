<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mozo</title>
<style>
body{
  background:#050505;
  color:#f5d28a;
  font-family:Arial;
  padding:10px;
}
.card{
  background:#101010;
  padding:16px;
  border-radius:14px;
  margin-bottom:14px;
  border:1px solid #222;
  transition: transform .3s, background .3s;
}
.card.listo{
  background:#d4af37;
  color:black;
  transform:scale(1.02);
}
button{
  padding:12px;
  border:none;
  border-radius:10px;
  background:#d4af37;
  color:black;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>
<body>

<h1>Panel Mozo</h1>
<div class="card">
  <h3>Nombre del mozo</h3>
  <input id="mozoNombre">
  <button onclick="guardarMozo()">Guardar</button>
</div>

<div id="mesas"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, doc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig={/* tu config */};
const app=initializeApp(firebaseConfig);
const db=getFirestore(app);
const cont=document.getElementById("mesas");
let mozo="";

function sonido(){
  new Audio("https://actions.google.com/sounds/v1/alarms/beep_short.ogg").play();
}

function vibrar(){
  if("vibrate" in navigator){
    navigator.vibrate([200,100,200]);
  }
}

window.guardarMozo=()=>{
  const n=document.getElementById("mozoNombre").value;
  if(!n) return;
  mozo=n;
  alert("Mozo: "+mozo);
};

/* MESAS */
onSnapshot(collection(db,"pedidos"),snap=>{
  cont.innerHTML="";

  snap.forEach(d=>{
    const data=d.data();
    if(data.estado === "listo"){
      cont.innerHTML+=`
      <div class="card listo">
        <h3>Mesa ${data.mesa}</h3>
        <p><strong>Total:</strong> $${data.total}</p>
        <p><strong>Nota:</strong> ${data.nota || "sin nota"}</p>
        <p><strong>Items:</strong><br>
          ${(data.items||[]).map(i=>`${i.prod} - $${i.precio}`).join("<br>")}
        </p>
        <input id="cobro-${d.id}" placeholder="Mozo que cobra">
        <button onclick="cobrar('${d.id}')">ðŸ’² Cobrar</button>
      </div>`;

      vibrar();
    }
  });
});

/* COBRAR */
window.cobrar=async(id)=>{
  const mozoCobro=document.getElementById(`cobro-${id}`).value;
  if(!mozoCobro) return alert("Ingrese mozo que cobra");

  await updateDoc(doc(db,"pedidos",id),{
    estado:"pagado",
    mozoCobro
  });

  sonido();
  vibrar();
};
</script>
</body>
</html>