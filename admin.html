<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin - Toto Bar</title>

<style>
body{
  background:black;
  color:#d4af37;
  font-family:Arial;
  padding:15px;
}

h1{
  text-align:center;
}

.card{
  border:1px solid #d4af37;
  padding:15px;
  border-radius:12px;
  margin-bottom:15px;
}

button{
  padding:8px;
  margin-top:5px;
  margin-right:5px;
  border:none;
  border-radius:6px;
  font-weight:bold;
}

.pendiente{ background:orange; color:black; }
.listo{ background:#d4af37; color:black; }
.entregado{ background:green; color:white; }
.eliminar{ background:red; color:white; }
</style>
</head>

<body>

<h1>Panel ADMIN</h1>
<div id="lista"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, onSnapshot, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCa-R6z76qoMt6Wf9EZFSqqGNY8U4JUMtM",
  authDomain: "menu-pro-app.firebaseapp.com",
  projectId: "menu-pro-app",
  storageBucket: "menu-pro-app.firebasestorage.app",
  messagingSenderId: "42917274964",
  appId: "1:42917274964:web:13e161810ad195718994c1"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const contenedor = document.getElementById("lista");

onSnapshot(collection(db,"pedidos"), snapshot=>{
  contenedor.innerHTML="";
  snapshot.forEach(docSnap=>{
    const d = docSnap.data();
    const fecha = d.fecha?.toDate ? d.fecha.toDate().toLocaleString() : "";

    contenedor.innerHTML+=`
      <div class="card">
        <h3>Mesa ${d.mesa}</h3>
        <p>${d.producto}</p>
        <p>$${d.precio}</p>
        <p>Estado: ${d.estado}</p>
        <p>${fecha}</p>

        <button class="pendiente" onclick="cambiar('${docSnap.id}','pendiente')">Pendiente</button>
        <button class="listo" onclick="cambiar('${docSnap.id}','listo')">Listo</button>
        <button class="entregado" onclick="cambiar('${docSnap.id}','entregado')">Entregado</button>
        <button class="eliminar" onclick="borrar('${docSnap.id}')">Eliminar</button>
      </div>
    `;
  });
});

window.cambiar = async (id,estado)=>{
  await updateDoc(doc(db,"pedidos",id),{estado});
}

window.borrar = async (id)=>{
  if(confirm("Â¿Eliminar pedido?")){
    await deleteDoc(doc(db,"pedidos",id));
  }
}
</script>

</body>
</html>