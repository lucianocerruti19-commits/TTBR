<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin</title>

<style>
body{
  background:#050505;
  color:#f5d28a;
  font-family:Arial;
  padding:14px;
}

.card{
  background:#101010;
  border:1px solid #2b2b2b;
  padding:16px;
  border-radius:16px;
  margin-bottom:16px;
}

button{
  padding:12px;
  border:none;
  border-radius:12px;
  background:linear-gradient(145deg, #d8b14a, #c59a32);
  color:black;
  font-weight:bold;
  cursor:pointer;
  margin-top:6px;
}
</style>
</head>
<body>

<h1>Panel Admin</h1>
<audio id="click" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

<div class="card">
  <h3>Crear sección</h3>
  <input id="nuevaCategoria" placeholder="Nombre sección">
  <button onclick="crearCategoria()">Crear</button>
</div>

<div class="card">
  <h3>Crear producto</h3>
  <input id="prodNombre" placeholder="Producto">
  <input id="prodPrecio" placeholder="Precio">
  <select id="prodCategoria"></select>
  <button onclick="agregarProducto()">Agregar</button>
</div>

<div id="pedidos"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import {
  getFirestore,
  collection,
  addDoc,
  onSnapshot,
  deleteDoc,
  doc
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "TU_API_KEY",
  authDomain: "TU_AUTH_DOMAIN",
  projectId: "TU_PROJECT_ID",
  storageBucket: "TU_STORAGE",
  messagingSenderId: "TU_SENDER",
  appId: "TU_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const click = document.getElementById("click");

/* SONIDO EN BOTONES */
document.addEventListener("click", e=>{
  if(e.target.tagName === "BUTTON"){
    click.play();
  }
});

/* CARGAR CATEGORIAS EN SELECT */
function cargarSelect(){
  onSnapshot(collection(db,"categorias"), snap=>{
    const sel = document.getElementById("prodCategoria");
    sel.innerHTML = "";

    snap.forEach(d=>{
      sel.innerHTML += `<option value="${d.data().nombre}">${d.data().nombre}</option>`;
    });
  });
}

/* CREAR SECCIÓN */
window.crearCategoria = async () => {
  const nombre = document.getElementById("nuevaCategoria").value;
  if(!nombre) return;

  await addDoc(collection(db,"categorias"),{nombre});
  document.getElementById("nuevaCategoria").value = "";
};

/* AGREGAR PRODUCTO */
window.agregarProducto = async () => {
  const nombre = document.getElementById("prodNombre").value;
  const precio = document.getElementById("prodPrecio").value;
  const categoria = document.getElementById("prodCategoria").value;

  if(!nombre || !precio) return;

  await addDoc(collection(db,"productos"),{
    nombre,
    precio,
    categoria
  });

  document.getElementById("prodNombre").value = "";
  document.getElementById("prodPrecio").value = "";
};

/* DETALLE DE PEDIDOS */
onSnapshot(collection(db,"pedidos"), snap=>{
  const cont = document.getElementById("pedidos");
  cont.innerHTML = "";

  snap.forEach(d=>{
    const p = d.data();

    cont.innerHTML += `
    <div class="card">
      <h3>Mesa ${p.mesa}</h3>
      <p><strong>Estado:</strong> ${p.estado}</p>
      <p><strong>Mozo:</strong> ${p.mozo || "—"}</p>
      <p><strong>Mozo cobro:</strong> ${p.mozoCobro || "—"}</p>
      <p><strong>Total:</strong> $${p.total}</p>
      <p><strong>Nota:</strong> ${p.nota || "sin nota"}</p>
      <p><strong>Items:</strong><br>
        ${(p.items||[]).map(i=>`${i.prod} - $${i.precio}`).join("<br>")}
      </p>
      <button onclick="eliminar('${d.id}')">Eliminar</button>
    </div>`;
  });
});

/* ELIMINAR */
window.eliminar = async (id) => {
  if(!confirm("Eliminar?")) return;
  await deleteDoc(doc(db,"pedidos",id));
};

cargarSelect();
</script>
</body>
</html>